# ll-hls-origin-example.go
Implements the HLS Origin API for a Low-Latency HLS media playlist as generated by the Beta Low Latency HLS tools (version 60 and above). Can be used as an alternative to the lowLatencyHLS.php script. 

Only tags relevant for Low Latency streaming are parsed. Other tags are ignored, but preserved by Decode() and Encode(). 

This code is meant as an example, and as such some Go best practices (i.e. using test, checking input format, and using libraries) have not been followed to make it easier to distribute and compile.

See https://developer.apple.com/documentation/http_live_streaming/protocol_extension_for_low-latency_hls_preliminary_specification for protocol specification


Command line flags:
```
  -certdir string
    	Dir with server.crt, and server.key files
  -dir string
    	Root dir with hls files
  -http string
    	Listen address (default ":8443")
```

* prep:
  * install the latest version of go : `brew install go`
  * install fsnotify dependency: `go get github.com/fsnotify/fsnotify`
* run:   
  `go run ll-hls-origin-example.go -certdir /usr/local/etc/certs -dir /usr/local/var/www -http :443`  
  where 
  * `/usr/local/etc/certs` is the directory that has the `server.crt` and `server.key` certificate files 
  * `/usr/local/var/www` is the directory that has the variant subdirectories that `mediastreamsegmenter` is writing the Low Latency HLS segments and `prog_index.m3u8` files to

One log line per request will be printed to stdout in the following format:
```
2020-01-23 09:09:58.300396 -0700 MST m=+542.326255627 10.123.4.123:59230 HTTP/2.0 GET  ll-hls-org.apple.com /media0/lowLatencyHLS?_HLS_msn=529&_HLS_part=2 966.872231ms 967.727263ms 2141 200 OK
^date^^^^^ ^time^^^^^^^^^^ ^timezone ^uptime^^^^^^^^^ ^^cient-ip:port^^^ ^proto^^ ^m^  ^host^^^^^^^^^^^^^^^ ^path^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ ^bd^^^^^^^^^ ^td^^^^^^^^^ ^sz^ ^stc^^

date            the date of the start of the request
time            the time of the start of the request
timezone        the timezone of the above date & time
uptime          the time in seconds since the start of the program
client-ip:port  client IP address and port
proto           the protocol used
m               the method used
host            the Host: header sent
path            the full path (including querystring) of the request
bd              the duration the server blocked to wait for the resource to become available
td              total duration from receiving the request to sending the last bit to the NIC
sz              size of object served
stc             status code and code string
```
